<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Entry=&gt;Data Blob · Caesar.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Caesar.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/">Introduction</a></li><li><a class="tocitem" href="../why_nongaussian/">Guassian vs. Non-Gaussian</a></li><li><a class="tocitem" href="../../installation_environment/">Installation</a></li><li><a class="tocitem" href="../using_julia/">Using Julia</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../concepts/">Initial Concepts</a></li><li><a class="tocitem" href="../building_graphs/">Building Factor Graphs</a></li><li><a class="tocitem" href="../interacting_fgs/">Solving and Interacting</a></li><li><a class="tocitem" href="../dataassociation/">Multi-Modal/Hypothesis</a></li><li><a class="tocitem" href="../../examples/parametric_solve/">Parametric Solve (EXP)</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/examples/">Caesar Examples</a></li><li><a class="tocitem" href="../../examples/basic_continuousscalar/">Canonical 1D Example</a></li><li><a class="tocitem" href="../../examples/basic_slamedonut/">Too few range-only</a></li><li><a class="tocitem" href="../../examples/basic_hexagonal2d/">Hexagonal 2D SLAM</a></li><li><a class="tocitem" href="../../examples/interm_fixedlag_hexagonal/">Fixed-Lag Solving 2D</a></li><li><a class="tocitem" href="../../examples/deadreckontether/">Dead Reckon Tether</a></li></ul></li><li><span class="tocitem">Graph Library</span><ul><li><a class="tocitem" href="../../examples/canonical_graphs/">Canonical Generators</a></li><li class="is-active"><a class="tocitem" href>Entry=&gt;Data Blob</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Adding-A-FolderStore"><span>Adding A FolderStore</span></a></li><li><a class="tocitem" href="#Adding-Data-Blobs"><span>Adding Data Blobs</span></a></li><li><a class="tocitem" href="#Retrieving-a-Data-Blob"><span>Retrieving a Data Blob</span></a></li><li><a class="tocitem" href="#Working-with-Binary-Data-(BSON)"><span>Working with Binary Data (BSON)</span></a></li></ul></li><li><a class="tocitem" href="../available_varfacs/">Variables/Factors</a></li><li><a class="tocitem" href="../flux_factors/">Flux (NN) Factors</a></li><li><a class="tocitem" href="../../examples/using_images/">Images and AprilTags</a></li></ul></li><li><span class="tocitem">Visualization</span><ul><li><a class="tocitem" href="../../install_viz/">Installing Viz</a></li><li><a class="tocitem" href="../2d_plotting/">Plotting (2D)</a></li><li><a class="tocitem" href="../arena_visualizations/">Visualization (3D)</a></li></ul></li><li><span class="tocitem">Middlewares</span><ul><li><a class="tocitem" href="../../examples/using_ros/">ROS Middleware</a></li><li><a class="tocitem" href="../compile_binary/">Compile Binaries</a></li><li><a class="tocitem" href="../database_interactions/">Cloud Server/Database</a></li><li><a class="tocitem" href="../multisession/">Multi-session/agent Solving</a></li><li><a class="tocitem" href="../multilang/">Multi-Language Support</a></li></ul></li><li><span class="tocitem">How to Expand?</span><ul><li><a class="tocitem" href="../../caesar_framework/">Pkg Framework</a></li><li><a class="tocitem" href="../../examples/adding_variables_factors/">Custom Variables and Factors</a></li><li><a class="tocitem" href="../../examples/custom_variables/">Creating Variables</a></li><li><a class="tocitem" href="../../examples/basic_definingfactors/">Creating Factors</a></li><li><a class="tocitem" href="../../func_ref/">More Functions</a></li></ul></li><li><span class="tocitem">Principles</span><ul><li><a class="tocitem" href="../../principles/filterCorrespondence/">Filters vs. Graphs</a></li><li><a class="tocitem" href="../../principles/approxConvDensities/">Generic Convolutions</a></li><li><a class="tocitem" href="../../principles/multiplyingDensities/">Multiplying Functions (.py)</a></li><li><a class="tocitem" href="../../principles/bayestreePrinciples/">Bayes (Junction) tree</a></li><li><a class="tocitem" href="../../principles/initializingOnBayesTree/">Advanced Bayes Tree Topics</a></li><li><a class="tocitem" href="../mmisam_alg/">Non-Gaussian Algorithm</a></li></ul></li><li><span class="tocitem">Developer Zone</span><ul><li><a class="tocitem" href="../../dev/wiki/">Wiki Pointers</a></li><li><a class="tocitem" href="../../principles/interm_dynpose/">Creating DynPose Factor</a></li><li><a class="tocitem" href="../../dev/known_issues/">Known Issue List</a></li><li><a class="tocitem" href="../../dev/internal_fncs/">Internal Functions</a></li></ul></li><li><span class="tocitem">Literature</span><ul><li><a class="tocitem" href="../../refs/literature/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Graph Library</a></li><li class="is-active"><a href>Entry=&gt;Data Blob</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Entry=&gt;Data Blob</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRobotics/Caesar.jl/blob/master/docs/src/concepts/entry_data.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Additional-(Large)-Data"><a class="docs-heading-anchor" href="#Additional-(Large)-Data">Additional (Large) Data</a><a id="Additional-(Large)-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-(Large)-Data" title="Permalink"></a></h1><p>There are a variety of situations that require more data to be stored natively in the factor graph object. This page will showcase some of <code>Entry=&gt;Data</code> features available.</p><h1 id="Adding-A-FolderStore"><a class="docs-heading-anchor" href="#Adding-A-FolderStore">Adding A FolderStore</a><a id="Adding-A-FolderStore-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-A-FolderStore" title="Permalink"></a></h1><p>Caesar.jl (with DFG) supports storage and retrieval of larger data blobs by means of various database/datastore technologies.  To get going, you can use a conventional <code>FolderStore</code>: </p><pre><code class="nohighlight hljs">getSolverParams(fg).logpath = pwd()
storeDir = joinLogPath(fg,&quot;data&quot;)
mkpath(storeDir)
# requires IIF v0.15, DFG v0.10
datastore = FolderStore{Vector{UInt8}}(:default_folder_store, storeDir) 
addBlobStore!(fg, datastore)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This example places the <code>data</code> folder in the <code>.logpath</code> location which defaults to <code>/tmp/caesar/UNIQUEDATETIME</code>. This is not a long term storage location since <code>/tmp</code> is periodically cleared by the operating system. Note that the <code>data</code> folder can be used in combination with <a href="https://juliarobotics.org/Caesar.jl/latest/concepts/interacting_fgs/#Saving-and-Loading">loading and saving factor graph objects</a>.</p></div></div><h2 id="Adding-Data-Blobs"><a class="docs-heading-anchor" href="#Adding-Data-Blobs">Adding Data Blobs</a><a id="Adding-Data-Blobs-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-Data-Blobs" title="Permalink"></a></h2><p>Just showcasing a JSON Dict approach</p><pre><code class="nohighlight hljs">using JSON2
someDict = Dict(:name =&gt; &quot;Jane&quot;, :data =&gt; randn(100))
addData!(fg, :default_folder_store, :x1, :datalabel, Vector{UInt8}(JSON2.write( someDict )), mimeType=&quot;application/json/octet-stream&quot;  )
# see retrieval example below...</code></pre><p>This approach allows the maximum flexibility, for example it is also possible to do:</p><pre><code class="language-julia hljs"># from https://juliaimages.org/stable/install/
using TestImages, Images, ImageView
img = testimage(&quot;mandrill&quot;)
imshow(img)

# TODO, convert to Vector{UInt8}
using ImageMagick, FileIO
# convert image to PNG bytestream
io = IOBuffer()
pngSm = Stream(format&quot;PNG&quot;, io)
save(pngSm, img)  # think FileIO is required for this
pngBytes = take!(io)
addData!(fg, :default_folder_store, :x1, :testImage, pngBytes, mimeType=&quot;image/png&quot;, description=&quot;mandrill test image&quot;  )</code></pre><h2 id="Retrieving-a-Data-Blob"><a class="docs-heading-anchor" href="#Retrieving-a-Data-Blob">Retrieving a Data Blob</a><a id="Retrieving-a-Data-Blob-1"></a><a class="docs-heading-anchor-permalink" href="#Retrieving-a-Data-Blob" title="Permalink"></a></h2><p>Data is stored as an <code>Entry =&gt; Blob</code> relationship, and the entries associated with a variable can be found via</p><pre><code class="language-julia hljs">julia&gt; listDataEntries(fg, :x6)
1-element Array{Symbol,1}:
 :JOYSTICK_CMD_VALS
 :testImage</code></pre><p>And retrieved via:</p><pre><code class="language-julia hljs">rawData = getData(fg, :x6, :JOYSTICK_CMD_VALS);
imgEntry, imgBytes = getData(fg, :x1, :testImage)</code></pre><p>Looking at <code>rawData</code> in a bit more detail:</p><pre><code class="language-julia hljs">julia&gt; rawData[1]
BlobStoreEntry(:JOYSTICK_CMD_VALS, UUID(&quot;d21fc841-6214-4196-a396-b1d5ef95be49&quot;), :default_folder_store, &quot;deeb3ed0cba6ffd149298de21c361af26a207e565e27a3cd3fa6c807b9aaa44d&quot;, &quot;DefaultUser|DefaultRobot|Session_851d81|x6&quot;, &quot;&quot;, &quot;application/json/octet-stream&quot;, TimeZones.ZonedDateTime(2020, 8, 15, 14, 26, 36, 397, tz&quot;UTC-04:00&quot;))

julia&gt; rawData[2]
3362-element Array{UInt8,1}:
 0x5b
 0x5b
 0x32
#...</code></pre><p>For <code>:testImage</code> the data was packed in a familiar <code>image/png</code> and can be converted backto bitmap (array) format:</p><pre><code class="language-julia hljs">rgb = ImageMagick.readblob(imgBytes); # automatically detected as PNG format

using ImageView
imshow(rgb)</code></pre><p>In the other case where data was packed as <code>&quot;application/json/octet-stream&quot;</code>:</p><pre><code class="language-julia hljs">myData = JSON2.read(IOBuffer(rawData[2]))

# as example
julia&gt; myData[1]
3-element Array{Any,1}:
                2017
 1532558043061497600
                    (buttons = Any[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], axis = Any[0, 0.25026196241378784, 0, 0, 0, 0])</code></pre><h3 id="Quick-Camera-Calibration-Storage-Example"><a class="docs-heading-anchor" href="#Quick-Camera-Calibration-Storage-Example">Quick Camera Calibration Storage Example</a><a id="Quick-Camera-Calibration-Storage-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Camera-Calibration-Storage-Example" title="Permalink"></a></h3><p>Consider storing camera calibration data inside the factor graph <code>tar.gz</code> object for later use:</p><pre><code class="language-julia hljs">fx = 341.4563903808594
fy = 341.4563903808594
cx = 329.19091796875
cy = 196.3658447265625

K = [-fx 0  cx;
      0 fy cy]

# Cheap way to include data as a Blob.  Also see the more hacky `Smalldata` alternative for situations that make sense.
camCalib = Dict(:size=&gt;size(K), :vecK=&gt;vec(K))
addData!(dfg,:default_folder_store,:x0,:camCalib,
         Vector{UInt8}(JSON2.write(camCalib)), mimeType=&quot;application/json/octet-stream&quot;, 
         description=&quot;reshape(camCalib[:vecK], camCalib[:size]...)&quot;) </code></pre><h2 id="Working-with-Binary-Data-(BSON)"><a class="docs-heading-anchor" href="#Working-with-Binary-Data-(BSON)">Working with Binary Data (BSON)</a><a id="Working-with-Binary-Data-(BSON)-1"></a><a class="docs-heading-anchor-permalink" href="#Working-with-Binary-Data-(BSON)" title="Permalink"></a></h2><p>Sometime it&#39;s useful to store binary data.  Let&#39;s combine the example of storing a Flux.jl Neural Network object using <a href="http://fluxml.ai/Flux.jl/stable/saving/#">the existing BSON approach</a>.  Also <a href="https://github.com/JuliaRobotics/IncrementalInference.jl/wiki/Coding-Templates#bson-iobuffer-and-base64">see BSON wrangling snippets here</a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We will store binary data as Base64 encoded string to avoid other framing problems.  See <a href="https://docs.julialang.org/en/v1/stdlib/Base64/#Base64.Base64EncodePipe">Julia Docs on Base64</a></p></div></div><pre><code class="language-julia hljs"># the object you wish to store as binary
model = Chain(Dense(5,2), Dense(2,3))

io = IOBuffer()

# using BSON
BSON.@save io model

# get base64 binary
mdlBytes = take!(io)

addData!(dfg,:default_folder_store,:x0,:nnModel,
         mdlBytes, mimeType=&quot;application/bson/octet-stream&quot;, 
         description=&quot;BSON.@load PipeBuffer(readBytes) model&quot;) </code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../examples/canonical_graphs/">« Canonical Generators</a><a class="docs-footer-nextpage" href="../available_varfacs/">Variables/Factors »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Monday 11 October 2021 18:54">Monday 11 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
