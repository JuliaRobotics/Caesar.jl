<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Building Factor Graphs · Caesar.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Caesar.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../installation_environment/">Installation</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul></li><li><span class="tocitem">Initial Concepts</span><ul><li><a class="tocitem" href="../concepts/">Caesar Concepts</a></li><li class="is-active"><a class="tocitem" href>Building Factor Graphs</a><ul class="internal"><li><a class="tocitem" href="#Initializing-a-Factor-Graph-1"><span>Initializing a Factor Graph</span></a></li><li><a class="tocitem" href="#Adding-to-the-Graph-1"><span>Adding to the Graph</span></a></li><li><a class="tocitem" href="#Variables-1"><span>Variables</span></a></li><li><a class="tocitem" href="#Factors-1"><span>Factors</span></a></li><li><a class="tocitem" href="#Which-Variables-and-Factors-to-use-1"><span>Which Variables and Factors to use</span></a></li></ul></li><li><a class="tocitem" href="../available_varfacs/">Available Variables/Factors</a></li><li><a class="tocitem" href="../interacting_fgs/">Interacting w/ Factor Graphs</a></li><li><a class="tocitem" href="../multilang/">Multi-Language Support</a></li><li><a class="tocitem" href="../arena_visualizations/">Arena Visualization</a></li><li><a class="tocitem" href="../database_interactions/">Cloud Server/Database</a></li><li><a class="tocitem" href="../multisession/">Multi/Cross Session Solving</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/examples/">Caesar Examples</a></li><li><a class="tocitem" href="../../examples/basic_continuousscalar/">ContinuousScalar as 1D Example</a></li><li><a class="tocitem" href="../../examples/basic_slamedonut/">Under-defined Trilateration SLAM 2D</a></li><li><a class="tocitem" href="../../examples/basic_hexagonal2d/">Hexagonal 2D SLAM</a></li><li><a class="tocitem" href="../../examples/interm_fixedlag_hexagonal/">Fixed-Lag Solving 2D</a></li></ul></li><li><span class="tocitem">Principles</span><ul><li><a class="tocitem" href="../../principles/filterCorrespondence/">Filters vs. Graphs</a></li><li><a class="tocitem" href="../../principles/approxConvDensities/">Generic Convolutions</a></li><li><a class="tocitem" href="../../principles/multiplyingDensities/">Multiplying Functions (.py)</a></li><li><a class="tocitem" href="../../principles/bayestreePrinciples/">Bayes (Junction) tree</a></li><li><a class="tocitem" href="../../principles/initializingOnBayesTree/">Advanced Bayes Tree Topics</a></li><li><a class="tocitem" href="../mmisam_alg/">Multimodal iSAM Algorithm</a></li></ul></li><li><span class="tocitem">How to Expand?</span><ul><li><a class="tocitem" href="../adding_variables_factors/">Custom Variables and Factors</a></li><li><a class="tocitem" href="../../examples/basic_definingfactors/">Creating Variables and Factors</a></li><li><a class="tocitem" href="../../examples/interm_dynpose/">Creating DynPose Factor</a></li></ul></li><li><span class="tocitem">Developer Zone</span><ul><li><a class="tocitem" href="../../dev/wiki/">Wiki Pointer</a></li></ul></li><li><span class="tocitem">Literature</span><ul><li><a class="tocitem" href="../../refs/literature/">References</a></li></ul></li><li><span class="tocitem">Function Reference</span><ul><li><a class="tocitem" href="../../func_ref/">Caesar&#39;s Reference</a></li><li><a class="tocitem" href="../../vis_func_ref/">Visualization Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Initial Concepts</a></li><li class="is-active"><a href>Building Factor Graphs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Building Factor Graphs</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRobotics/Caesar.jl/blob/master/docs/src/concepts/building_graphs.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Building-and-Solving-Graphs-1"><a class="docs-heading-anchor" href="#Building-and-Solving-Graphs-1">Building and Solving Graphs</a><a class="docs-heading-anchor-permalink" href="#Building-and-Solving-Graphs-1" title="Permalink"></a></h1><p>Irrespective of your application - real-time robotics, batch processing of survey data, or really complex multi-hypothesis modeling - you&#39;re going to need to add factors and variables to a graph. This section discusses how to do that in Caesar.</p><p>The following sections discuss the steps required to construct a graph and solve it:</p><ul><li>Initialing the Factor Graph</li><li>Adding Variables and Factors to the Graph</li><li>Solving the Graph</li><li>Informing the Solver About Ready Data</li></ul><h2 id="Initializing-a-Factor-Graph-1"><a class="docs-heading-anchor" href="#Initializing-a-Factor-Graph-1">Initializing a Factor Graph</a><a class="docs-heading-anchor-permalink" href="#Initializing-a-Factor-Graph-1" title="Permalink"></a></h2><pre><code class="language-julia">using Caesar, RoME, Distributions

# start with an empty factor graph object
fg = initfg()</code></pre><h2 id="Adding-to-the-Graph-1"><a class="docs-heading-anchor" href="#Adding-to-the-Graph-1">Adding to the Graph</a><a class="docs-heading-anchor-permalink" href="#Adding-to-the-Graph-1" title="Permalink"></a></h2><p>Factor graphs are made of two constituent parts:</p><ul><li>Variables</li><li>Factors</li></ul><h2 id="Variables-1"><a class="docs-heading-anchor" href="#Variables-1">Variables</a><a class="docs-heading-anchor-permalink" href="#Variables-1" title="Permalink"></a></h2><p>Variables (a.k.a. poses in localization terminology) are created in the same way  shown above for the landmark. Variables contain a label, a data type (e.g. in 2D <code>RoME.Point2</code> or <code>RoME.Pose2</code>). Note that variables are solved - i.e. they are the product, what you wish to calculate when the solver runs - so you don&#39;t provide any measurements when creating them.</p><pre><code class="language-julia"># Add the first pose :x0
addVariable!(fg, :x0, Pose2)
# Add a few more poses
for i in 1:10
  addVariable!(fg, Symbol(&quot;x$(i)&quot;), Pose2)
end</code></pre><h2 id="Factors-1"><a class="docs-heading-anchor" href="#Factors-1">Factors</a><a class="docs-heading-anchor-permalink" href="#Factors-1" title="Permalink"></a></h2><p>Factors are algebraic relationships between variables based on data cues such as sensor measurements. Examples of factors are absolute (pre-resolved) GPS readings (unary factors/priors) and odometry changes between pose variables. All factors encode a stochastic measurement (measurement + error), such as below, where a <a href="https://www.juliarobotics.org/Caesar.jl/latest/concepts/available_varfacs/#IncrementalInference.Prior"><code>IIF.Prior</code></a> belief is add to <code>x0</code> (using the <a href="https://www.juliarobotics.org/Caesar.jl/latest/func_ref/#DistributedFactorGraphs.addFactor!"><code>addFactor</code></a> call) as a normal distribution centered around <code>[0,0,0]</code>.</p><h3 id="Priors-1"><a class="docs-heading-anchor" href="#Priors-1">Priors</a><a class="docs-heading-anchor-permalink" href="#Priors-1" title="Permalink"></a></h3><pre><code class="language-julia"># Add at a fixed location Prior to pin :x0 to a starting location (0,0,pi/6.0)
addFactor!(fg, [:x0], IIF.Prior( MvNormal([0; 0; pi/6.0], Matrix(Diagonal([0.1;0.1;0.05].^2)) )))</code></pre><h3 id="Factors-Between-Variables-1"><a class="docs-heading-anchor" href="#Factors-Between-Variables-1">Factors Between Variables</a><a class="docs-heading-anchor-permalink" href="#Factors-Between-Variables-1" title="Permalink"></a></h3><pre><code class="language-julia"># Add odometry indicating a zigzag movement
for i in 1:10
  pp = Pose2Pose2(MvNormal([10.0;0; (i % 2 == 0 ? -pi/3 : pi/3)], Matrix(Diagonal([0.1;0.1;0.1].^2))))
  addFactor!(fg, [Symbol(&quot;x$(i-1)&quot;); Symbol(&quot;x$(i)&quot;)], pp )
end</code></pre><h3 id="When-to-Instantiate-Poses-(i.e.-new-Variables-in-Factor-Graph)-1"><a class="docs-heading-anchor" href="#When-to-Instantiate-Poses-(i.e.-new-Variables-in-Factor-Graph)-1">When to Instantiate Poses (i.e. new Variables in Factor Graph)</a><a class="docs-heading-anchor-permalink" href="#When-to-Instantiate-Poses-(i.e.-new-Variables-in-Factor-Graph)-1" title="Permalink"></a></h3><p>Consider a robot traversing some area while exploring, localizing, and wanting to find strong loop-closure features for consistent mapping.  The creation of new poses and landmark variables is a trade-off in computational complexity and marginalization errors made during factor graph construction.  Common triggers for new poses are:</p><ul><li>Time-based trigger (eg. new pose a second or 5 minutes if stationary)</li><li>Distance traveled (eg. new pose every 0.5 meters)</li><li>Rotation angle (eg. new pose every 15 degrees)</li></ul><p>Computation will progress faster if poses and landmarks are very sparse.  To extract the benefit of dense reconstructions, one approach is to use the factor graph as sparse index in history about the general progression of the trajectory and use additional processing from dense sensor data for high-fidelity map reconstructions.  Either interpolations, or better direct reconstructions from inertial data can be used for dense reconstruction.</p><p>For completeness, one could also re-project the most meaningful measurements from sensor measurements between pose epochs as though measured from the pose epoch.  This approach essentially marginalizes the local dead reckoning drift errors into the local interpose re-projections, but helps keep the pose count low.</p><p>In addition, see <a href="https://www.juliarobotics.org/Caesar.jl/latest/examples/examples/#Hexagonal-2D-1">fixed-lag discussion</a> for limiting during inference the number of fluid variables manually to a user desired count.</p><h2 id="Which-Variables-and-Factors-to-use-1"><a class="docs-heading-anchor" href="#Which-Variables-and-Factors-to-use-1">Which Variables and Factors to use</a><a class="docs-heading-anchor-permalink" href="#Which-Variables-and-Factors-to-use-1" title="Permalink"></a></h2><p>See the next page on <a href="https://www.juliarobotics.org/Caesar.jl/latest/concepts/available_varfacs/">available variables and factors</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../concepts/">« Caesar Concepts</a><a class="docs-footer-nextpage" href="../available_varfacs/">Available Variables/Factors »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 11 January 2020 16:16">Saturday 11 January 2020</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
