<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Legacy Factors · Caesar.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Caesar.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/">Introduction</a></li><li><a class="tocitem" href="../../concepts/why_nongaussian/">Gaussian vs. Non-Gaussian</a></li><li><a class="tocitem" href="../../installation_environment/">Installation</a></li><li><a class="tocitem" href="../../concepts/using_julia/">Using Julia</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../concepts/concepts/">Initial Concepts</a></li><li><a class="tocitem" href="../../concepts/building_graphs/">Building Graphs</a></li><li><a class="tocitem" href="../../concepts/solving_graphs/">Solving Graphs</a></li><li><a class="tocitem" href="../../concepts/interacting_fgs/">Interact w Graphs</a></li><li><a class="tocitem" href="../../concepts/dataassociation/">Multi-Modal/Hypothesis</a></li><li><a class="tocitem" href="../../concepts/parallel_processing/">Parallel Processing</a></li><li><a class="tocitem" href="../parametric_solve/">[DEV] Parametric Solve</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/">Caesar Examples</a></li><li><a class="tocitem" href="../basic_continuousscalar/">Canonical 1D Example</a></li><li><a class="tocitem" href="../basic_slamedonut/">Underconstrained Range-only</a></li><li><a class="tocitem" href="../basic_hexagonal2d/">Hexagonal 2D SLAM</a></li><li><a class="tocitem" href="../interm_fixedlag_hexagonal/">Fixed-Lag Solving 2D</a></li><li><a class="tocitem" href="../deadreckontether/">Dead Reckon Tether</a></li></ul></li><li><span class="tocitem">Graph Library</span><ul><li><a class="tocitem" href="../canonical_graphs/">Canonical Generators</a></li><li><a class="tocitem" href="../../concepts/available_varfacs/">Variables/Factors</a></li><li><a class="tocitem" href="../../concepts/entry_data/">Entry=&gt;Data Blob</a></li><li><a class="tocitem" href="../using_images/">Images and AprilTags</a></li><li><a class="tocitem" href="../using_pcl/">Pointclouds and PCL</a></li><li><a class="tocitem" href="../../concepts/using_manifolds/">Using Manifolds.jl</a></li><li><a class="tocitem" href="../../concepts/flux_factors/">Flux (NN) Factors</a></li></ul></li><li><span class="tocitem">Visualization</span><ul><li><a class="tocitem" href="../../install_viz/">Installing Viz</a></li><li><a class="tocitem" href="../../concepts/2d_plotting/">Plotting (2D)</a></li><li><a class="tocitem" href="../../concepts/arena_visualizations/">Visualization (3D)</a></li></ul></li><li><span class="tocitem">Middlewares</span><ul><li><a class="tocitem" href="../using_ros/">ROS Middleware</a></li><li><a class="tocitem" href="../../concepts/compile_binary/">Compile Binaries</a></li><li><a class="tocitem" href="../../concepts/zero_install/">Zero Install Solution</a></li><li><a class="tocitem" href="../../concepts/multisession/">Multi-session/agent Solving</a></li><li><a class="tocitem" href="../../concepts/multilang/">Multi-Language Support</a></li></ul></li><li><span class="tocitem">How to Expand?</span><ul><li><a class="tocitem" href="../../caesar_framework/">Pkg Framework</a></li><li><a class="tocitem" href="../custom_variables/">Custom Variables</a></li><li><a class="tocitem" href="../basic_definingfactors/">Custom Prior Factor</a></li><li><a class="tocitem" href="../custom_relative_factors/">Custom Relative Factor</a></li><li><a class="tocitem" href="../../concepts/stash_and_cache/">Caching and Stashing</a></li><li><a class="tocitem" href="../custom_factor_features/">Important Factor Features</a></li><li><a class="tocitem" href="../adding_variables_factors/">Variable/Factor Considerations</a></li><li><a class="tocitem" href="../../func_ref/">More Functions</a></li></ul></li><li><span class="tocitem">Principles</span><ul><li><a class="tocitem" href="../../principles/filterCorrespondence/">Filters vs. Graphs</a></li><li><a class="tocitem" href="../../principles/approxConvDensities/">Generic Convolutions</a></li><li><a class="tocitem" href="../../principles/multiplyingDensities/">Multiplying Functions (.py)</a></li><li><a class="tocitem" href="../../principles/bayestreePrinciples/">Bayes (Junction) tree</a></li><li><a class="tocitem" href="../../principles/initializingOnBayesTree/">Advanced Bayes Tree Topics</a></li><li><a class="tocitem" href="../../concepts/mmisam_alg/">Non-Gaussian Algorithm</a></li></ul></li><li><span class="tocitem">Developer Zone</span><ul><li><a class="tocitem" href="../../dev/wiki/">Wiki Pointers</a></li><li class="is-active"><a class="tocitem" href>Legacy Factors</a><ul class="internal"><li><a class="tocitem" href="#Relative-Factors-(Legacy)"><span>Relative Factors (Legacy)</span></a></li></ul></li><li><a class="tocitem" href="../../principles/interm_dynpose/">Creating DynPose Factor</a></li><li><a class="tocitem" href="../../dev/known_issues/">Known Issue List</a></li><li><a class="tocitem" href="../../dev/internal_fncs/">Internal Functions</a></li></ul></li><li><span class="tocitem">Literature</span><ul><li><a class="tocitem" href="../../refs/literature/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Zone</a></li><li class="is-active"><a href>Legacy Factors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Legacy Factors</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRobotics/Caesar.jl/blob/master/docs/src/examples/legacy_deffactors.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Relative-Factors-(Legacy)"><a class="docs-heading-anchor" href="#Relative-Factors-(Legacy)">Relative Factors (Legacy)</a><a id="Relative-Factors-(Legacy)-1"></a><a class="docs-heading-anchor-permalink" href="#Relative-Factors-(Legacy)" title="Permalink"></a></h2><h3 id="One-Dimension-Roots-Example"><a class="docs-heading-anchor" href="#One-Dimension-Roots-Example">One Dimension Roots Example</a><a id="One-Dimension-Roots-Example-1"></a><a class="docs-heading-anchor-permalink" href="#One-Dimension-Roots-Example" title="Permalink"></a></h3><p>Previously we looked at adding a prior.  This section demonstrates the first of two <code>&lt;:AbstractRelative</code> factor types.  These are factors that introduce only relative information between variables in the factor graph.</p><p>This example is on <code>&lt;:IIF.AbstractRelativeRoots</code>.  First, lets create the factor as before </p><pre><code class="language-julia hljs">struct MyFactor{T &lt;: SamplableBelief} &lt;: IIF.AbstractRelativeRoots
  Z::T
end
getSample(cfo::CalcFactor{&lt;:MyFactor}, N::Int=1) = (reshape(rand(cfo.factor.Z,N) ,1,N), )

function (cfo::CalcFactor{&lt;:MyFactor})( measurement_z,
                                        x1,
                                        x2  )
  #
  res = measurement_z - (x2[1] - x1[1])
  return res
end</code></pre><p>The selection of <code>&lt;:IIF.AbstractRelativeRoots</code>, akin to earlier <code>&lt;:AbstractPrior</code>, instructs IIF to find the roots of the provided residual function.  That is the one dimensional residual function, <code>res[1] = measurement - prediction</code>, is used during inference to approximate the convolution of conditional beliefs from the approximate beliefs of the connected variables in the factor graph.</p><p>Important aspects to note, <code>&lt;:IIF.AbstractRelativeRoots</code> requires all elements <code>length(res)</code> (the factor measurement dimension) to have a feasible zero crossing solution.  A two dimensional system will solve for variables where both <code>res[1]==0</code> and <code>res[2]==0</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>As of IncrementalInference v0.21, CalcResidual no longer takes a residual as input parameter and should return residual, see IIF#467.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Measurements and variables passed in to the factor residual function do not have the same type as when constructing the factor graph.  It is recommended to leave these incoming types unrestricted.  If you must define the types, these either are (or will be) of element type relating to the manifold on which the measurement or variable beliefs reside.  Probably a vector or manifolds type.  Usage can be very case specific, and hence better to let Julia type-inference automation do the hard work for you. The </p></div></div><h3 id="Two-Dimension-Minimize-Example"><a class="docs-heading-anchor" href="#Two-Dimension-Minimize-Example">Two Dimension Minimize Example</a><a id="Two-Dimension-Minimize-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Two-Dimension-Minimize-Example" title="Permalink"></a></h3><p>The second type is <code>&lt;:IIF.AbstractRelativeMinimize</code> which simply minimizes the residual vector of the user factor. This type is useful for partial constraint situations where the residual function is not gauranteed to have zero crossings in all dimensions and the problem is converted into a minimization problem instead:</p><pre><code class="language-julia hljs">struct OtherFactor{T &lt;: SamplableBelief} &lt;: IIF.AbstractRelativeMinimize
  Z::T             # assuming something 2 dimensional
  userdata::String # or whatever is necessary
end

# just illustrating some arbitraty second value in tuple of different size
getSample(cfo::CalcFactor{&lt;:OtherFactor}, N::Int=1) = (rand(cfo.factor.z,N), rand())

function (cfo::CalcFactor{&lt;:OtherFactor})(res::AbstractVector{&lt;:Real},
                                          z,
                                          second_val,
                                          x1,
                                          x2 )
  #
  # @assert length(z) == 2
  # not doing anything with `second_val` but illustrating
  # not doing anything with `cfo.factor.userdata` either
  
  # the broadcast operators with automatically vectorize
  res = z .- (x1[1:2] .- x1[1:2])
  return res
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../dev/wiki/">« Wiki Pointers</a><a class="docs-footer-nextpage" href="../../principles/interm_dynpose/">Creating DynPose Factor »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 26 December 2022 13:00">Monday 26 December 2022</span>. Using Julia version 1.8.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
