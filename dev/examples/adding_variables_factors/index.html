<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom Variables and Factors · Caesar.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Caesar.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Welcome</span><ul><li><a class="tocitem" href="../../installation_environment/">Installation</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../concepts/concepts/">Initial Concepts</a></li><li><a class="tocitem" href="../../concepts/building_graphs/">Building Factor Graphs</a></li><li><a class="tocitem" href="../../concepts/interacting_fgs/">Solving and Interacting</a></li><li><a class="tocitem" href="../../concepts/available_varfacs/">Internal Variables/Factors</a></li><li><a class="tocitem" href="../../concepts/dataassociation/">Multi-Modal/Hypothesis</a></li><li><a class="tocitem" href="../../concepts/flux_factors/">Flux (NN) Factors</a></li><li><a class="tocitem" href="../../concepts/2d_plotting/">Plotting (2D)</a></li><li><a class="tocitem" href="../../concepts/entry_data/">Entry=&gt;Data Blob</a></li><li><a class="tocitem" href="../../concepts/multilang/">Multi-Language Support</a></li><li><a class="tocitem" href="../../concepts/database_interactions/">Cloud Server/Database</a></li><li><a class="tocitem" href="../../concepts/multisession/">Multi-session/agent Solving</a></li><li><a class="tocitem" href="../parametric_solve/">Parametric Solve (EXP)</a></li><li><a class="tocitem" href="../../concepts/arena_visualizations/">Visualization (3D)</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/">Caesar Examples</a></li><li><a class="tocitem" href="../basic_continuousscalar/">ContinuousScalar as 1D Example</a></li><li><a class="tocitem" href="../basic_slamedonut/">Under-defined Trilateration, 2D</a></li><li><a class="tocitem" href="../basic_hexagonal2d/">Hexagonal 2D SLAM</a></li><li><a class="tocitem" href="../interm_fixedlag_hexagonal/">Fixed-Lag Solving 2D</a></li><li><a class="tocitem" href="../using_ros/">ROS Middleware</a></li><li><a class="tocitem" href="../deadreckontether/">Dead Reckon Tether</a></li></ul></li><li><span class="tocitem">Principles</span><ul><li><a class="tocitem" href="../../principles/filterCorrespondence/">Filters vs. Graphs</a></li><li><a class="tocitem" href="../../principles/approxConvDensities/">Generic Convolutions</a></li><li><a class="tocitem" href="../../principles/multiplyingDensities/">Multiplying Functions (.py)</a></li><li><a class="tocitem" href="../../principles/bayestreePrinciples/">Bayes (Junction) tree</a></li><li><a class="tocitem" href="../../principles/initializingOnBayesTree/">Advanced Bayes Tree Topics</a></li><li><a class="tocitem" href="../../concepts/mmisam_alg/">Multimodal iSAM Algorithm</a></li></ul></li><li><span class="tocitem">How to Expand?</span><ul><li class="is-active"><a class="tocitem" href>Custom Variables and Factors</a><ul class="internal"><li><a class="tocitem" href="#New-Variable/Factor-Considerations"><span>New Variable/Factor Considerations</span></a></li><li><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#[OPTIONAL]-Creating-a-Repository"><span>[OPTIONAL] Creating a Repository</span></a></li><li><a class="tocitem" href="#Unit-Tests"><span>Unit Tests</span></a></li><li><a class="tocitem" href="#Using-your-Types-with-the-Caesar-Solver"><span>Using your Types with the Caesar Solver</span></a></li><li><a class="tocitem" href="#Contributing-back-to-the-Community"><span>Contributing back to the Community</span></a></li></ul></li><li><a class="tocitem" href="../custom_variables/">Creating Variables</a></li><li><a class="tocitem" href="../basic_definingfactors/">Creating Factors</a></li></ul></li><li><span class="tocitem">Developer Zone</span><ul><li><a class="tocitem" href="../../dev/wiki/">Wiki Pointers</a></li><li><a class="tocitem" href="../../principles/interm_dynpose/">Creating DynPose Factor</a></li><li><a class="tocitem" href="../../dev/known_issues/">Known Issue List</a></li><li><a class="tocitem" href="../../dev/internal_fncs/">Internal Functions</a></li></ul></li><li><span class="tocitem">Literature</span><ul><li><a class="tocitem" href="../../refs/literature/">References</a></li></ul></li><li><span class="tocitem">Function Reference</span><ul><li><a class="tocitem" href="../../func_ref/">Caesar&#39;s Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to Expand?</a></li><li class="is-active"><a href>Custom Variables and Factors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom Variables and Factors</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRobotics/Caesar.jl/blob/master/docs/src/examples/adding_variables_factors.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Creating-New-Variables-and-Factors"><a class="docs-heading-anchor" href="#Creating-New-Variables-and-Factors">Creating New Variables and Factors</a><a id="Creating-New-Variables-and-Factors-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-New-Variables-and-Factors" title="Permalink"></a></h1><p>In most scenarios, the existing variables and factors should be sufficient for most robotics applications. Caesar however, is extensible and allows you to easily incorporate your own variable and factor types for specialized applications.</p><h2 id="New-Variable/Factor-Considerations"><a class="docs-heading-anchor" href="#New-Variable/Factor-Considerations">New Variable/Factor Considerations</a><a id="New-Variable/Factor-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#New-Variable/Factor-Considerations" title="Permalink"></a></h2><p>A couple of important points:</p><ul><li>You <strong>do not need to</strong> modify/fork/edit internal Caesar/RoME/IncrementalInference source code to introduce new variable and factor types!</li><li>As long as the factors exist in the working space when the solver is run, the factors are automatically used – this is possible due to Julia&#39;s <a href="https://docs.julialang.org/en/v1/manual/methods/index.html">multiple dispatch design</a></li><li>Caesar is designed to allow you to add new variables and factors to your own independent repository and incorporate them at will at compile-time or even run-time</li><li>Residual function definitions for new factors types use a <a href="https://discourse.julialang.org/t/documenting-a-functor-callable-struct/8444">callable struct (a.k.a functor) architecture</a> to simultaneously allow:  <ul><li>Multiple dispatch (i.e. &#39;polymorphic&#39; behavior)</li><li>Meta-data and in-place memory storage for advanced and performant code</li><li>An outside callback implementation style</li></ul></li><li>In most robotics scenarios, there is no need for new variables or factors:<ul><li>Variables have various mechanisms that allow you to attach data to them, e.g. raw sensory data or identified April tags, so you do not need to create a new variable type just to store data</li><li>New variables are required only if you are representing a new state - TODO: Example of needed state</li><li>New factors are needed if:<ul><li>You need to represent a constraint for a variable (known as a singleton) and that constraint type doesn&#39;t exist</li><li>You need to represent a constraint between two variables and that constraint type doesn&#39;t exist</li></ul></li></ul></li></ul><h2 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h2><p>We suggest the following design pattern for developing and building new factors:</p><ol><li>You have reviewed the variable and factor types available in Caesar, RoME, and IncrementalInference and a new type is required - please see <a href="https://www.juliarobotics.org/Caesar.jl/latest/concepts/available_varfacs/">Building and Solving Graphs</a> if you want to review what is currently available</li><li>[OPTIONAL] Create a GitHub repository to store the new types (new types in the Julia Main scope is perfectly okay!)</li><li>Create your new variable types</li><li>Create your new factor types</li><li>Implement unit tests to validate the correct operation of the types</li><li>Set up your solver to make use the custom types</li></ol><p>1.1. This is much easier than it sounds</p><ol><li>If the code is public and may be useful to the community, we ask if you could submit an issue against Caesar with information about the new types and the repository. Ideally we&#39;d like to continually improve the core code and fold in community contributions.</li></ol><p>The remainder of this section discusses each of these steps.</p><h2 id="[OPTIONAL]-Creating-a-Repository"><a class="docs-heading-anchor" href="#[OPTIONAL]-Creating-a-Repository">[OPTIONAL] Creating a Repository</a><a id="[OPTIONAL]-Creating-a-Repository-1"></a><a class="docs-heading-anchor-permalink" href="#[OPTIONAL]-Creating-a-Repository" title="Permalink"></a></h2><p>You can fork the following template repository to construct your own <a href="https://github.com/GearsAD/Caesar_VariableFactorExamples.jl.git">Caesar Variable and Factor Examples</a>.</p><p>If this repository is going to be used for development of the new variables/factors as well as for the experiment (i.e. the code that builds the graph and solves it), you should probably start a simple end-to-end test that validates a basic version of your experimental setup (e.g. ):</p><pre><code class="language-julia">#### This example is a basic test of the new variables and factors
#### that are added in this repo. The example is derived from
#### the hexagonal test example.

using Caesar, RoME
using Caesar_VariableFactorExamples # Your new variable/factor repository
# Using plotting for experiment validation
using RoMEPlotting

# 1. Init factor graph
#TODO

# 2. Add variables
#TODO

# 3. Add factors
# 3a. Add a new test prior
#TODO
# 3b. Add new types of odometry factors.
#TODO

# 4. Solve graph
solveTree!(fg)

# 5. Graph solution - assuming that you have this open in Atom.
plotSLAM2DPoses(fg)</code></pre><h2 id="Unit-Tests"><a class="docs-heading-anchor" href="#Unit-Tests">Unit Tests</a><a id="Unit-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Tests" title="Permalink"></a></h2><p>What you should test:</p><ul><li>Creation of the factor</li><li>Sampling of the factor</li><li>Residual testing</li><li>Solving using the variables and factors</li><li>Serialization and deserialization</li></ul><p>An example of these tests can be seen for the trivial case shown in the example repo <a href="https://github.com/GearsAD/Caesar_VariableFactorExamples.jl/blob/master/test/ExamplePrior.jl">ExamplePrior Unit Tests</a>.</p><h2 id="Using-your-Types-with-the-Caesar-Solver"><a class="docs-heading-anchor" href="#Using-your-Types-with-the-Caesar-Solver">Using your Types with the Caesar Solver</a><a id="Using-your-Types-with-the-Caesar-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Using-your-Types-with-the-Caesar-Solver" title="Permalink"></a></h2><p>As above, as long as you bring your factors into the workspace, you should be able to use them in your experimental setup.</p><p>You can validate this with the existence check code in <a href="../../concepts/building_graphs/#Building-and-Solving-Graphs">Building and Solving Graphs</a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This has been made available as <code>IncrementalInference.getCurrentWorkspaceVariables()</code> and <code>IncrementalInference.getCurrentWorkspaceFactors()</code>.</p></div></div><h2 id="Contributing-back-to-the-Community"><a class="docs-heading-anchor" href="#Contributing-back-to-the-Community">Contributing back to the Community</a><a id="Contributing-back-to-the-Community-1"></a><a class="docs-heading-anchor-permalink" href="#Contributing-back-to-the-Community" title="Permalink"></a></h2><p>Consider contributioning back, so if you have developed variables and factors that may be useful to the community, please write up an issue in <a href="https://github.com/JuliaRobotics/Caesar.jl">Caesar.jl</a> or submit a PR to the relavent repo.  Note also that work is ongoing to simplify and consolidate the code structure given all previously known feature requests and requirements.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../concepts/mmisam_alg/">« Multimodal iSAM Algorithm</a><a class="docs-footer-nextpage" href="../custom_variables/">Creating Variables »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 29 March 2021 21:20">Monday 29 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
