<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Bayes (Junction) tree · Caesar.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Caesar.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Welcome</span><ul><li><a class="tocitem" href="../../installation_environment/">Installation</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../concepts/concepts/">Initial Concepts</a></li><li><a class="tocitem" href="../../concepts/building_graphs/">Building Factor Graphs</a></li><li><a class="tocitem" href="../../concepts/interacting_fgs/">Interacting w/ Factor Graphs</a></li><li><a class="tocitem" href="../../concepts/dataassociation/">Data Association</a></li><li><a class="tocitem" href="../../concepts/available_varfacs/">Available Variables/Factors</a></li><li><a class="tocitem" href="../../concepts/2d_plotting/">Plotting (2D)</a></li><li><a class="tocitem" href="../../concepts/multilang/">Multi-Language Support</a></li><li><a class="tocitem" href="../../concepts/database_interactions/">Cloud Server/Database</a></li><li><a class="tocitem" href="../../concepts/multisession/">Multi-session/agent Solving</a></li><li><a class="tocitem" href="../../concepts/arena_visualizations/">Visualization (3D)</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/examples/">Caesar Examples</a></li><li><a class="tocitem" href="../../examples/basic_continuousscalar/">ContinuousScalar as 1D Example</a></li><li><a class="tocitem" href="../../examples/basic_slamedonut/">Under-defined Trilateration, 2D</a></li><li><a class="tocitem" href="../../examples/basic_hexagonal2d/">Hexagonal 2D SLAM</a></li><li><a class="tocitem" href="../../examples/interm_fixedlag_hexagonal/">Fixed-Lag Solving 2D</a></li></ul></li><li><span class="tocitem">Principles</span><ul><li><a class="tocitem" href="../filterCorrespondence/">Filters vs. Graphs</a></li><li><a class="tocitem" href="../approxConvDensities/">Generic Convolutions</a></li><li><a class="tocitem" href="../multiplyingDensities/">Multiplying Functions (.py)</a></li><li class="is-active"><a class="tocitem" href>Bayes (Junction) tree</a><ul class="internal"><li><a class="tocitem" href="#Why-a-Bayes-(Junction)-tree-1"><span>Why a Bayes (Junction) tree</span></a></li><li><a class="tocitem" href="#What-is-a-Bayes-(Junction)-tree-1"><span>What is a Bayes (Junction) tree</span></a></li><li><a class="tocitem" href="#Constructing-a-Tree-1"><span>Constructing a Tree</span></a></li><li><a class="tocitem" href="#Visualizing-1"><span>Visualizing</span></a></li><li><a class="tocitem" href="#Variable-Ordering-1"><span>Variable Ordering</span></a></li><li><a class="tocitem" href="#Interfacing-with-&#39;mmisam&#39;-Solver-1"><span>Interfacing with &#39;mmisam&#39; Solver</span></a></li><li><a class="tocitem" href="#Clique-State-Machine-1"><span>Clique State Machine</span></a></li></ul></li><li><a class="tocitem" href="../initializingOnBayesTree/">Advanced Bayes Tree Topics</a></li><li><a class="tocitem" href="../../concepts/mmisam_alg/">Multimodal iSAM Algorithm</a></li></ul></li><li><span class="tocitem">How to Expand?</span><ul><li><a class="tocitem" href="../../concepts/adding_variables_factors/">Custom Variables and Factors</a></li><li><a class="tocitem" href="../../examples/basic_definingfactors/">Creating Variables and Factors</a></li><li><a class="tocitem" href="../../examples/interm_dynpose/">Creating DynPose Factor</a></li></ul></li><li><span class="tocitem">Developer Zone</span><ul><li><a class="tocitem" href="../../dev/wiki/">Wiki Pointers</a></li></ul></li><li><span class="tocitem">Literature</span><ul><li><a class="tocitem" href="../../refs/literature/">References</a></li></ul></li><li><span class="tocitem">Function Reference</span><ul><li><a class="tocitem" href="../../func_ref/">Caesar&#39;s Reference</a></li><li><a class="tocitem" href="../../vis_func_ref/">Visualization Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Principles</a></li><li class="is-active"><a href>Bayes (Junction) tree</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Bayes (Junction) tree</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRobotics/Caesar.jl/blob/master/docs/src/principles/bayestreePrinciples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Principle:-Bayes-tree-prototyping-1"><a class="docs-heading-anchor" href="#Principle:-Bayes-tree-prototyping-1">Principle: Bayes tree prototyping</a><a class="docs-heading-anchor-permalink" href="#Principle:-Bayes-tree-prototyping-1" title="Permalink"></a></h1><p>This page describes how to visualize, study, test, and compare Bayes (Junction) tree concepts with special regard for variable ordering.</p><h2 id="Why-a-Bayes-(Junction)-tree-1"><a class="docs-heading-anchor" href="#Why-a-Bayes-(Junction)-tree-1">Why a Bayes (Junction) tree</a><a class="docs-heading-anchor-permalink" href="#Why-a-Bayes-(Junction)-tree-1" title="Permalink"></a></h2><p>The tree is algebraicly equivalent–-but acyclic–-structure to the factor graph:  i.) Inference is easier on on acyclic graphs; ii.) We can exploit Smart Message Passing benefits (known from the full conditional independence structure encoded in the tree), since the tree represents the &quot;complete form&quot; when marginalizing each variable one at a time (also known as elimination game, marginalization, also related to smart factors).  In loose terms, the Bayes (Junction) tree has implicit access to all Schur complements (if it parametric and linearized) of each variable to all others.  Please see <a href="https://www.juliarobotics.org/Caesar.jl/latest/principles/initializingOnBayesTree/">this page more information regarding advanced topics on the Bayes tree</a>.</p><h2 id="What-is-a-Bayes-(Junction)-tree-1"><a class="docs-heading-anchor" href="#What-is-a-Bayes-(Junction)-tree-1">What is a Bayes (Junction) tree</a><a class="docs-heading-anchor-permalink" href="#What-is-a-Bayes-(Junction)-tree-1" title="Permalink"></a></h2><p>The Bayes tree data structure is a rooted and directed Junction tree (maximal elimination clique tree). It allows for exact inference to be carried out by leveraging and exposing the variables&#39; conditional independence and, very interestingly, can be directly associated with the sparsity pattern exhibited by a system&#39;s factorized upper triangular square root information matrix (see picture below).</p><p><img src="https://user-images.githubusercontent.com/27132241/69210533-f55da400-0b52-11ea-89dd-f18b7fa983b8.png" alt="graph and matrix analagos"/></p><p>Following this matrix-graph parallel, the picture also shows what the associated matrix interpretation is for a factor graph (~first order expansion in the form of a measurement Jacobian) and its corresponding Markov random field (sparsity pattern corresponding to the information matrix).</p><p>The procedure for obtaining the Bayes (Junction) tree is outlined in the figure shown below (factor graph to chrodal Bayes net via bipartite elimination game, and chordal Bayes net to Bayes tree via maximum cardinality search algorithm).</p><p><img src="https://user-images.githubusercontent.com/27132241/69210647-5eddb280-0b53-11ea-82ab-dc5ff89c4a43.png" alt="add the fg2net2tree outline"/></p><h2 id="Constructing-a-Tree-1"><a class="docs-heading-anchor" href="#Constructing-a-Tree-1">Constructing a Tree</a><a class="docs-heading-anchor-permalink" href="#Constructing-a-Tree-1" title="Permalink"></a></h2><p>Trees and factor graphs are separated in the implementation, allowing the user to construct multiple different trees from one factor graph except for a few temporary values in the factor graph.</p><pre><code class="language-julia">using IncrementalInference # RoME or Caesar will work too

## construct a distributed factor graph object
fg = initfg()
# add variables and factors
# ...

## build the tree
tree = wipeBuildNewTree!(fg)</code></pre><p>The temporary values are <code>wiped</code> from the distributed factor graph object <code>fg&lt;:AbstractDFG</code> and a new tree is constructed.  This <code>wipeBuildNewTree!</code> call can be repeated as many times the user desires and results should be consistent for the same factor graph structure (regardless of numerical values contained within).</p><h2 id="Visualizing-1"><a class="docs-heading-anchor" href="#Visualizing-1">Visualizing</a><a class="docs-heading-anchor-permalink" href="#Visualizing-1" title="Permalink"></a></h2><p>IncrementalInference.jl includes functions for visualizing the Bayes tree, and uses outside packages such as GraphViz (standard) and Latex tools (experimental, optional) to do so.  </p><h3 id="GraphViz-1"><a class="docs-heading-anchor" href="#GraphViz-1">GraphViz</a><a class="docs-heading-anchor-permalink" href="#GraphViz-1" title="Permalink"></a></h3><pre><code class="language-julia">drawTree(tree, show=true) # , filepath=&quot;/tmp/caesar/mytree.pdf&quot;</code></pre><h3 id="Latex-Tikz-(Optional)-1"><a class="docs-heading-anchor" href="#Latex-Tikz-(Optional)-1">Latex Tikz (Optional)</a><a class="docs-heading-anchor-permalink" href="#Latex-Tikz-(Optional)-1" title="Permalink"></a></h3><p><strong>EXPERIMENTAL</strong>, requiring special import.</p><p>First make sure the following packages are installed on your system:</p><pre><code class="language-none">$ sudo apt-get install texlive-pictures dot2tex
$ pip install dot2tex</code></pre><p>Then in Julia you should be able to do:</p><pre><code class="language-julia">import IncrementalInference: generateTexTree

generateTexTree(tree)</code></pre><p>An example Bayes (Junction) tree representation obtained through <code>generateTexTree(tree)</code> for the sample factor graph shown above can be seen in the following image.</p><p align="center">
<img src="https://user-images.githubusercontent.com/27132241/69210722-9e0c0380-0b53-11ea-9462-7964844b89b1.png" width="200" border="0" />
</p><h3 id="Visualizing-Clique-Adjacency-Matrix-1"><a class="docs-heading-anchor" href="#Visualizing-Clique-Adjacency-Matrix-1">Visualizing Clique Adjacency Matrix</a><a class="docs-heading-anchor-permalink" href="#Visualizing-Clique-Adjacency-Matrix-1" title="Permalink"></a></h3><p>It is also possible to see the upward message passing variable/factor association matrix for each clique, requiring the Gadfly.jl package:</p><pre><code class="language-julia">using Gadfly

spyCliqMat(tree, :x1) # provided by IncrementalInference

#or embedded in graphviz
drawTree(tree, imgs=true, show=true)</code></pre><h2 id="Variable-Ordering-1"><a class="docs-heading-anchor" href="#Variable-Ordering-1">Variable Ordering</a><a class="docs-heading-anchor-permalink" href="#Variable-Ordering-1" title="Permalink"></a></h2><h3 id="Getting-the-AMD-Variable-Ordering-1"><a class="docs-heading-anchor" href="#Getting-the-AMD-Variable-Ordering-1">Getting the AMD Variable Ordering</a><a class="docs-heading-anchor-permalink" href="#Getting-the-AMD-Variable-Ordering-1" title="Permalink"></a></h3><p>The variable ordering is described as a <code>::Vector{Symbol}</code>.</p><pre><code class="language-julia">vo = getEliminationOrder(fg)
tree = buildTreeFromOrdering!(fg, vo)</code></pre><p>The temporary elimination values in <code>fg</code> can be reset with (currently rather aggressive):</p><pre><code class="language-julia">resetFactorGraphNewTree!(fg)</code></pre><p>These steps are combined in a wrapper function:</p><pre><code class="language-julia">resetBuildTreeFromOrder!(fg, vo)</code></pre><h3 id="Manipulating-the-Variable-Ordering-1"><a class="docs-heading-anchor" href="#Manipulating-the-Variable-Ordering-1">Manipulating the Variable Ordering</a><a class="docs-heading-anchor-permalink" href="#Manipulating-the-Variable-Ordering-1" title="Permalink"></a></h3><pre><code class="language-julia">vo = [:x1; :l3; :x2; ...]</code></pre><blockquote><p><strong>Note</strong> that a list of variables or factors can be obtained through the <code>ls</code> and related functions:</p></blockquote><p>Variables:</p><pre><code class="language-julia">unsorted = ls(fg)
unsorted = ls(fg, Pose2) # by variable type
unsorted = ls(fg, r&quot;x&quot;)  # by regex
unsorted = intersect(ls(fg, r&quot;x&quot;), ls(fg, Pose2))  # by regex

# sorting
sorted = sortDFG(unsorted)  # deprecated name sortVarNested(unsorted)</code></pre><p>Factors:</p><pre><code class="language-julia">unsorted = lsf(fg)
unsorted = ls(fg, Pose2Point2BearingRange)</code></pre><h2 id="Interfacing-with-&#39;mmisam&#39;-Solver-1"><a class="docs-heading-anchor" href="#Interfacing-with-&#39;mmisam&#39;-Solver-1">Interfacing with &#39;mmisam&#39; Solver</a><a class="docs-heading-anchor-permalink" href="#Interfacing-with-&#39;mmisam&#39;-Solver-1" title="Permalink"></a></h2><p>The regular solver used in IIF is:</p><pre><code class="language-julia">tree, smt, hist = solveTree!(fg)</code></pre><p>where a new tree is constructed internally.  In order to recycle computations from a previous tree, the following interface can be used:</p><pre><code class="language-julia">tree, smt, hist = solveTree!(fg, tree)</code></pre><p>which will replace the <code>tree</code> object pointer to the new tree object after solution.  The following parmaters (set before calling <code>solveTree!</code>) will show the solution progress on the tree visualization:</p><pre><code class="language-julia">getSolverParams(fg).drawtree = true
getSolverParams(fg).showtree = true</code></pre><h2 id="Clique-State-Machine-1"><a class="docs-heading-anchor" href="#Clique-State-Machine-1">Clique State Machine</a><a class="docs-heading-anchor-permalink" href="#Clique-State-Machine-1" title="Permalink"></a></h2><p>The mmisam solver is based on a state machine design to handle the inter and intra clique operations during a variety of situations.  Use of the clique state machine (CSM) makes debugging, development, verification, and modification of the algorithm real easy.  Contact us for any support regarding modifications to the default algorithm.  For pre-docs on working with CSM, please see <a href="https://github.com/JuliaRobotics/IncrementalInference.jl/issues/443">IIF #443</a>.</p><h3 id="STATUS-of-a-Clique-1"><a class="docs-heading-anchor" href="#STATUS-of-a-Clique-1">STATUS of a Clique</a><a class="docs-heading-anchor-permalink" href="#STATUS-of-a-Clique-1" title="Permalink"></a></h3><p>CSM currently uses the following statusses for each of the cliques during the inference process.</p><pre><code class="language-julia">[:initialized;:upsolved;:marginalized;:downsolved;:uprecycled]</code></pre><h3 id="Bayes-Tree-Legend-(from-IIF)-1"><a class="docs-heading-anchor" href="#Bayes-Tree-Legend-(from-IIF)-1">Bayes Tree Legend (from IIF)</a><a class="docs-heading-anchor-permalink" href="#Bayes-Tree-Legend-(from-IIF)-1" title="Permalink"></a></h3><p>The color legend is currently recorded in an <a href="https://github.com/JuliaRobotics/IncrementalInference.jl/issues/349">issue thread here</a>.</p><ul><li>Blank / white – uninitialized,</li><li>Red – CPU working on clique&#39;s Chapman-Kolmogorov inference (up or down),</li><li>Light red – completed upsolve,</li><li>Tomato – partial dimension upsolve but finished,</li><li>Green – trying to initialize,</li><li>Brown – initialized but not solved yet (likely child cliques that depend on downward autoinit msgs),</li><li>Purple – blocking on autoinit for more parent/sibling derived down msgs,</li><li>Turquoise – blocking for on parent for downsolve msgs,</li><li>Light blue – completed downsolve,</li><li>Blue – fully marginalized clique that will not be updated during upsolve (maybe downsolved),</li><li>Orange – recycled clique upsolve solution from previous tree passed into solveTree!</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../multiplyingDensities/">« Multiplying Functions (.py)</a><a class="docs-footer-nextpage" href="../initializingOnBayesTree/">Advanced Bayes Tree Topics »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 24 April 2020 22:06">Friday 24 April 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
