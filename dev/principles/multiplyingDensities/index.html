<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multiplying Functions (.py) · Caesar.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Caesar.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/">Introduction</a></li><li><a class="tocitem" href="../../concepts/why_nongaussian/">Guassian vs. Non-Gaussian</a></li><li><a class="tocitem" href="../../installation_environment/">Installation</a></li><li><a class="tocitem" href="../../concepts/using_julia/">Using Julia</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../concepts/concepts/">Initial Concepts</a></li><li><a class="tocitem" href="../../concepts/building_graphs/">Building Graphs</a></li><li><a class="tocitem" href="../../concepts/solving_graphs/">Solving Graphs</a></li><li><a class="tocitem" href="../../concepts/interacting_fgs/">Interact w Graphs</a></li><li><a class="tocitem" href="../../concepts/dataassociation/">Multi-Modal/Hypothesis</a></li><li><a class="tocitem" href="../../concepts/parallel_processing/">Parallel Processing</a></li><li><a class="tocitem" href="../../examples/parametric_solve/">[DEV] Parametric Solve</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/examples/">Caesar Examples</a></li><li><a class="tocitem" href="../../examples/basic_continuousscalar/">Canonical 1D Example</a></li><li><a class="tocitem" href="../../examples/basic_slamedonut/">Underconstrained Range-only</a></li><li><a class="tocitem" href="../../examples/basic_hexagonal2d/">Hexagonal 2D SLAM</a></li><li><a class="tocitem" href="../../examples/interm_fixedlag_hexagonal/">Fixed-Lag Solving 2D</a></li><li><a class="tocitem" href="../../examples/deadreckontether/">Dead Reckon Tether</a></li></ul></li><li><span class="tocitem">Graph Library</span><ul><li><a class="tocitem" href="../../examples/canonical_graphs/">Canonical Generators</a></li><li><a class="tocitem" href="../../concepts/entry_data/">Entry=&gt;Data Blob</a></li><li><a class="tocitem" href="../../concepts/available_varfacs/">Variables/Factors</a></li><li><a class="tocitem" href="../../concepts/flux_factors/">Flux (NN) Factors</a></li><li><a class="tocitem" href="../../examples/using_images/">Images and AprilTags</a></li></ul></li><li><span class="tocitem">Visualization</span><ul><li><a class="tocitem" href="../../install_viz/">Installing Viz</a></li><li><a class="tocitem" href="../../concepts/2d_plotting/">Plotting (2D)</a></li><li><a class="tocitem" href="../../concepts/arena_visualizations/">Visualization (3D)</a></li></ul></li><li><span class="tocitem">Middlewares</span><ul><li><a class="tocitem" href="../../examples/using_ros/">ROS Middleware</a></li><li><a class="tocitem" href="../../concepts/compile_binary/">Compile Binaries</a></li><li><a class="tocitem" href="../../concepts/zero_install/">Zero Install Solution</a></li><li><a class="tocitem" href="../../concepts/multisession/">Multi-session/agent Solving</a></li><li><a class="tocitem" href="../../concepts/multilang/">Multi-Language Support</a></li></ul></li><li><span class="tocitem">How to Expand?</span><ul><li><a class="tocitem" href="../../caesar_framework/">Pkg Framework</a></li><li><a class="tocitem" href="../../examples/adding_variables_factors/">Custom Variables and Factors</a></li><li><a class="tocitem" href="../../examples/custom_variables/">Creating Variables</a></li><li><a class="tocitem" href="../../examples/basic_definingfactors/">Creating Factors</a></li><li><a class="tocitem" href="../../func_ref/">More Functions</a></li></ul></li><li><span class="tocitem">Principles</span><ul><li><a class="tocitem" href="../filterCorrespondence/">Filters vs. Graphs</a></li><li><a class="tocitem" href="../approxConvDensities/">Generic Convolutions</a></li><li class="is-active"><a class="tocitem" href>Multiplying Functions (.py)</a><ul class="internal"><li><a class="tocitem" href="#Products-of-Infinite-Objects-(Functionals)"><span>Products of Infinite Objects (Functionals)</span></a></li><li><a class="tocitem" href="#Starting-the-ZMQ-server"><span>Starting the ZMQ server</span></a></li><li><a class="tocitem" href="#Functional-Products-via-Python"><span>Functional Products via Python</span></a></li><li><a class="tocitem" href="#A-Basic-Factor-Graph-Product-Illustration"><span>A Basic Factor Graph Product Illustration</span></a></li></ul></li><li><a class="tocitem" href="../bayestreePrinciples/">Bayes (Junction) tree</a></li><li><a class="tocitem" href="../initializingOnBayesTree/">Advanced Bayes Tree Topics</a></li><li><a class="tocitem" href="../../concepts/mmisam_alg/">Non-Gaussian Algorithm</a></li></ul></li><li><span class="tocitem">Developer Zone</span><ul><li><a class="tocitem" href="../../dev/wiki/">Wiki Pointers</a></li><li><a class="tocitem" href="../interm_dynpose/">Creating DynPose Factor</a></li><li><a class="tocitem" href="../../dev/known_issues/">Known Issue List</a></li><li><a class="tocitem" href="../../dev/internal_fncs/">Internal Functions</a></li></ul></li><li><span class="tocitem">Literature</span><ul><li><a class="tocitem" href="../../refs/literature/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Principles</a></li><li class="is-active"><a href>Multiplying Functions (.py)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multiplying Functions (.py)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRobotics/Caesar.jl/blob/master/docs/src/principles/multiplyingDensities.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Principle:-Multiplying-Functions-(Python)"><a class="docs-heading-anchor" href="#Principle:-Multiplying-Functions-(Python)">Principle: Multiplying Functions (Python)</a><a id="Principle:-Multiplying-Functions-(Python)-1"></a><a class="docs-heading-anchor-permalink" href="#Principle:-Multiplying-Functions-(Python)" title="Permalink"></a></h1><p>This example illustrates a central concept in Caesar.jl (and the multimodal-iSAM algorithm), whereby different probability belief functions are multiplied together. The true product between various likelihood beliefs is very complicated to compute, but a good approximations exist. In addition, <code>ZmqCaesar</code> offers a <code>ZMQ</code> interface to the factor graph solution for multilanguage support.  This example is a small subset that shows how to use the <code>ZMQ</code> infrastructure, but avoids the larger factor graph related calls.</p><h2 id="Products-of-Infinite-Objects-(Functionals)"><a class="docs-heading-anchor" href="#Products-of-Infinite-Objects-(Functionals)">Products of Infinite Objects (Functionals)</a><a id="Products-of-Infinite-Objects-(Functionals)-1"></a><a class="docs-heading-anchor-permalink" href="#Products-of-Infinite-Objects-(Functionals)" title="Permalink"></a></h2><p>Consider multiplying multiple belief density functions together, for example</p><p class="math-container">\[f = f_1 \times f_2 \times f_3\]</p><p>which is a core operation required for solving the <a href="http://www.juliarobotics.org/Caesar.jl/latest/concepts/mmisam_alg/">Chapman-Kolmogorov transit equations</a>.</p><h3 id="Direct-Julia-Calculation"><a class="docs-heading-anchor" href="#Direct-Julia-Calculation">Direct Julia Calculation</a><a id="Direct-Julia-Calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-Julia-Calculation" title="Permalink"></a></h3><p>The <a href="http://www.github.com/JuliaRobotics/ApproxManifoldProducts.jl">ApproxManifoldProducts.jl</a> package (experimental) is meant to unify many on-manifold product operations, and can be called directly in Julia:</p><pre><code class="language-julia hljs">using ApproxManifoldProducts

f1 = manikde!(randn(100,1).-3.0, (:Euclid,))
f2 = manikde!(randn(100,1).+3.0, (:Euclid,))
...

f12 = maniproduct([f1;f2], (:Euclid,))</code></pre><blockquote><p>Also see previous <a href="http://www.github.com/JuliaRobotics/KernelDensityEstimate.jl">KernelDensityEstimate.jl</a>.</p></blockquote><p>To make Caesar.jl usable from other languages, a ZMQ server interface model has been developed which can also be used to test this principle functional product operation.</p><h3 id="Not-Susceptible-to-Particle-Depletion"><a class="docs-heading-anchor" href="#Not-Susceptible-to-Particle-Depletion">Not Susceptible to Particle Depletion</a><a id="Not-Susceptible-to-Particle-Depletion-1"></a><a class="docs-heading-anchor-permalink" href="#Not-Susceptible-to-Particle-Depletion" title="Permalink"></a></h3><p>The product process of say <code>f1*f2</code> <strong>is not a importance sampling procedure</strong> that is commonly used in particle filtering, but instead a more advanced Bayesian inference process based on a wide variety of academic literature.  The KernelDensityEstimate method is a stochastic method, what active research is looking into deterministic homotopy/continuation methods.</p><p>The easy example that demonstrates that particle depletion is avoided here, is where <code>f1</code> and <code>f2</code> are represented by well separated and evenly weighted samples – the Bayesian inference &#39;product&#39; technique efficiently produces new (evenly weighted) samples for <code>f12</code> somewhere in between <code>f1</code> and <code>f2</code>, but clearly not overlapping the original population of samples used for <code>f1</code> and <code>f2</code>.  In contrast, conventional particle filtering measurement updates would have &quot;de-weighted&quot; particles of either input function and then be rejected during an eventual resampling step, thereby depleting the sample population.</p><h2 id="Starting-the-ZMQ-server"><a class="docs-heading-anchor" href="#Starting-the-ZMQ-server">Starting the ZMQ server</a><a id="Starting-the-ZMQ-server-1"></a><a class="docs-heading-anchor-permalink" href="#Starting-the-ZMQ-server" title="Permalink"></a></h2><p>Caesar.jl provides a <a href="http://github.com/JuliaRobotics/Caesar.jl/blob/master/scripts/zmqServer.sh">startup script for a default ZMQ instance</a>.  Start a server and allow precompilations to finish, as indicated by a printout message &quot;waiting to receive...&quot;.  More <a href="http://www.juliarobotics.org/Caesar.jl/latest/concepts/multilang/#Starting-the-Caesar-ZMQ-Navigation-Server-1">details here</a>.</p><h2 id="Functional-Products-via-Python"><a class="docs-heading-anchor" href="#Functional-Products-via-Python">Functional Products via Python</a><a id="Functional-Products-via-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Functional-Products-via-Python" title="Permalink"></a></h2><p>Clone the Python <a href="http://github.com/nicrip/graff_py/blob/4ab4691f457f6ff816356df79850dd6c47809115/examples/product.py#L1"><code>GraffSDK.py</code> code here</a> and look at the <code>product.py</code> file.</p><pre><code class="language-python hljs">import sys
sys.path.append(&#39;..&#39;)

import numpy as np
from graff.Endpoint import Endpoint
from graff.Distribution.Normal import Normal
from graff.Distribution.SampleWeights import SampleWeights
from graff.Distribution.BallTreeDensity import BallTreeDensity

from graff.Core import MultiplyDistributions

import matplotlib.pyplot as plt

if __name__ == &#39;__main__&#39;:
    e = Endpoint()

    e.Connect(&#39;tcp://192.168.0.102:5555&#39;)
    print(e.Status())

    N = 1000
    u1 = 0.0
    s1 = 10.0
    x1 = u1+s1*np.random.randn(N)

    u2 = 50.0
    s2 = 10.0
    x2 = u2+s2*np.random.randn(N)
    b1 = BallTreeDensity(&#39;Gaussian&#39;, np.ones(N), np.ones(N), x1)
    b2 = BallTreeDensity(&#39;Gaussian&#39;, np.ones(N), np.ones(N), x2)

    rep = MultiplyDistributions(e, [b1,b2])
    print(rep)
    x = np.array(rep[&#39;points&#39;] )
    # plt.stem(x, np.ones(len(x)) )
    plt.hist(x, bins = int(len(x)/10.0), color= &#39;m&#39;)
    plt.hist(x1, bins = int(len(x)/10.0),color=&#39;r&#39;)
    plt.hist(x2, bins = int(len(x)/10.0),color=&#39;b&#39;)
    plt.show()

    e.Disconnect()</code></pre><h2 id="A-Basic-Factor-Graph-Product-Illustration"><a class="docs-heading-anchor" href="#A-Basic-Factor-Graph-Product-Illustration">A Basic Factor Graph Product Illustration</a><a id="A-Basic-Factor-Graph-Product-Illustration-1"></a><a class="docs-heading-anchor-permalink" href="#A-Basic-Factor-Graph-Product-Illustration" title="Permalink"></a></h2><p>Using the factor graph methodology, we can repeat the example by adding variable and two prior factors.  This can be done directly in Julia (or via ZMQ in the further Python example below)</p><h3 id="Products-of-Functions-(Factor-Graphs-in-Julia)"><a class="docs-heading-anchor" href="#Products-of-Functions-(Factor-Graphs-in-Julia)">Products of Functions (Factor Graphs in Julia)</a><a id="Products-of-Functions-(Factor-Graphs-in-Julia)-1"></a><a class="docs-heading-anchor-permalink" href="#Products-of-Functions-(Factor-Graphs-in-Julia)" title="Permalink"></a></h3><p>Directly in Julia:</p><pre><code class="language-julia hljs">using IncrementalInference

fg = initfg()

addVariable!(fg, :x0, ContinuousScalar)
addFactor!(fg, [:x0], Prior(Normal(-3.0,1.0)))
addFactor!(fg, [:x0], Prior(Normal(+3.0,1.0)))

solveTree!(fg)

# plot the results
using KernelDensityEstimatePlotting

plotKDE(getKDE(fg, :x0))</code></pre><p>Example figure:</p><p align="center">
<img src="https://raw.githubusercontent.com/JuliaRobotics/Caesar.jl/master/docs/imgs/productexample.png" width="480" border="0" />
</p><h3 id="Products-of-Functions-(Via-Python-and-ZmqCaesar)"><a class="docs-heading-anchor" href="#Products-of-Functions-(Via-Python-and-ZmqCaesar)">Products of Functions (Via Python and ZmqCaesar)</a><a id="Products-of-Functions-(Via-Python-and-ZmqCaesar)-1"></a><a class="docs-heading-anchor-permalink" href="#Products-of-Functions-(Via-Python-and-ZmqCaesar)" title="Permalink"></a></h3><p>We repeat the example using Python and the ZMQ interface:</p><pre><code class="language-python hljs">import sys
sys.path.append(&#39;..&#39;)

import numpy as np
from graff.Endpoint import Endpoint
from graff.Distribution.Normal import Normal
from graff.Distribution.SampleWeights import SampleWeights
from graff.Distribution.BallTreeDensity import BallTreeDensity

from graff.Core import MultiplyDistributions


if __name__ == &#39;__main__&#39;:
    &quot;&quot;&quot;

    &quot;&quot;&quot;
    e.Connect(&#39;tcp://127.0.0.1:5555&#39;)
    print(e.Status())

    # Add the first pose x0
    x0 = Variable(&#39;x0&#39;, &#39;ContinuousScalar&#39;)
    e.AddVariable(x0)

    # Add at a fixed location PriorPose2 to pin x0 to a starting location
    prior = Factor(&#39;Prior&#39;, [&#39;x0&#39;], Normal(np.zeros(1,1)-3.0, np.eye(1)) )
    e.AddFactor(prior)
    prior = Factor(&#39;Prior&#39;, [&#39;x0&#39;], Normal(np.zeros(1,1)+3.0, np.eye(1)) )
    e.AddFactor(prior)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../approxConvDensities/">« Generic Convolutions</a><a class="docs-footer-nextpage" href="../bayestreePrinciples/">Bayes (Junction) tree »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Friday 22 October 2021 18:15">Friday 22 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
